<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¶ ç‹—ç‹—å¹´é½¡è¨ˆç®—æ©Ÿ (å«å„²å­˜)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS éƒ¨åˆ† --- */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f4f7f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .calculator-container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 25px;
            font-weight: 700;
        }

        .dog-image span {
            font-size: 80px;
            display: block;
            margin-bottom: 20px;
            color: #ff9800;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 300;
        }

        input[type="date"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
        }

        button {
            background-color: #ff9800;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            width: 100%;
            font-weight: 700;
        }

        button:hover {
            background-color: #e68900;
        }

        .result-box {
            margin-top: 30px;
            padding: 20px;
            background-color: #e3f2fd;
            border-radius: 10px;
            border-left: 5px solid #2196f3;
            text-align: left;
        }

        .result-box p {
            margin: 10px 0;
            font-size: 1.1em;
            color: #333;
        }

        .highlight-dog {
            font-size: 1.2em;
            font-weight: 700;
            color: #00796b;
        }

        .highlight-human {
            font-size: 1.2em;
            font-weight: 700;
            color: #d32f2f;
        }

        .hidden {
            display: none;
        }

        .reference-note {
            font-size: 0.8em;
            color: #888;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="calculator-container">
        <h1>ğŸ¶ ç‹—ç‹—å¹´é½¡æ›ç®—è¨ˆç®—æ©Ÿ</h1>
        
        <div class="dog-image">
            <span role="img" aria-label="A friendly dog face">ğŸ•</span>
        </div>

        <div class="input-group">
            <label for="dog-dob">è«‹è¼¸å…¥ç‹—ç‹—çš„å‡ºç”Ÿå¹´æœˆæ—¥ï¼š</label>
            <input type="date" id="dog-dob" required>
        </div>
        
        <button id="calculate-btn">é–‹å§‹è¨ˆç®—</button>

        <div id="result-container" class="result-box hidden">
            <p>ç¾åœ¨å¤§ç´„ <span id="dog-age" class="highlight-dog">...</span> æ­²çš„ç‹—å¹´é½¡</p>
            <p>æ›ç®—æˆäººé¡å¹´é½¡å¤§ç´„æ˜¯ <span id="human-age" class="highlight-human">...</span> æ­²</p>
        </div>

        <p class="reference-note">
            *è¨ˆç®—å…¬å¼åƒè€ƒè‡ªç§‘å­¸æ–‡ç»ï¼š$$A_{\text{human}} = 16 \ln(A_{\text{dog}}) + 31$$
        </p>
    </div>

    <script>
        // --- JavaScript éƒ¨åˆ† ---
        const calculateBtn = document.getElementById('calculate-btn');
        const dobInput = document.getElementById('dog-dob');
        const resultContainer = document.getElementById('result-container');
        const dogAgeDisplay = document.getElementById('dog-age');
        const humanAgeDisplay = document.getElementById('human-age');
        
        const DOG_DOB_STORAGE_KEY = 'dogDOB';
        const DOG_AGE_STORAGE_KEY = 'dogAge';
        const HUMAN_AGE_STORAGE_KEY = 'humanAge';

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œï¼šæª¢æŸ¥ä¸¦è¼‰å…¥ä¸Šæ¬¡çš„é‹ç®—çµæœ
        window.addEventListener('load', loadLastResult);
        calculateBtn.addEventListener('click', calculateDogAge);


        function calculateDogAge() {
            const dobValue = dobInput.value;

            if (!dobValue) {
                alert("è«‹é¸æ“‡ç‹—ç‹—çš„å‡ºç”Ÿå¹´æœˆæ—¥ï¼");
                resultContainer.classList.add('hidden');
                return;
            }

            const dob = new Date(dobValue);
            const today = new Date();
            
            // å°‡ä»Šå¤©çš„æ™‚é–“è¨­ç‚ºåˆå¤œï¼Œç¢ºä¿è¨ˆç®—ç²¾ç¢ºåˆ°æ—¥
            today.setHours(0, 0, 0, 0); 
            dob.setHours(0, 0, 0, 0); 

            if (dob > today) {
                alert("å‡ºç”Ÿå¹´æœˆæ—¥ä¸èƒ½æ™šæ–¼ä»Šå¤©ï¼Œè«‹é‡æ–°è¼¸å…¥ï¼");
                resultContainer.classList.add('hidden');
                return;
            }

            // è¨ˆç®—ç‹—ç‹—çš„å¯¦éš›å¹´é½¡ï¼ˆä»¥å¹´ç‚ºå–®ä½ï¼Œç²¾ç¢ºåˆ°å°æ•¸ï¼‰
            const diffTime = Math.abs(today.getTime() - dob.getTime());
            // æ¯å¹´æ¯«ç§’æ•¸ï¼š1000ms/s * 60s/min * 60min/hr * 24hr/day * 365.25 days/year
            const msPerYear = 1000 * 60 * 60 * 24 * 365.25;
            const dogAgeYears = diffTime / msPerYear;

            let humanAge;
            let formattedDogAge;
            let formattedHumanAge;

            if (dogAgeYears < 0.001) { 
                // å¦‚æœç‹—ç‹—å°æ–¼ä¸€å¤©ï¼Œå¹´é½¡å¹¾ä¹ç‚ºé›¶
                humanAge = 0;
                formattedDogAge = "0.0";
            } else {
                // ä½¿ç”¨å…¬å¼ï¼š A_human = 16 * ln(A_dog) + 31
                humanAge = 16 * Math.log(dogAgeYears) + 31;
                formattedDogAge = dogAgeYears.toFixed(1);
            }
            
            // é¡¯ç¤ºäººé¡å¹´é½¡ï¼ˆç¢ºä¿å¹´é½¡ä¸ç‚ºè² æ•¸ï¼Œä¿ç•™ä¸€ä½å°æ•¸ï¼‰
            formattedHumanAge = Math.max(0, humanAge).toFixed(1);

            // 4. å„²å­˜çµæœåˆ° localStorage
            saveResult(dobValue, formattedDogAge, formattedHumanAge);

            // 5. é¡¯ç¤ºçµæœ
            displayResult(formattedDogAge, formattedHumanAge);
        }

        /**
         * å„²å­˜ç‹—ç‹—å‡ºç”Ÿæ—¥æœŸã€è¨ˆç®—å‡ºçš„ç‹—ç‹—å¹´é½¡å’Œäººé¡å¹´é½¡åˆ° localStorage
         * @param {string} dob - ç‹—ç‹—å‡ºç”Ÿæ—¥æœŸ (YYYY-MM-DD)
         * @param {string} dogAge - æ ¼å¼